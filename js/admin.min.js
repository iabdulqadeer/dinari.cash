"use strict";!function(){function t(t,e=-1){return BOXCoin.loading(t,e)}function e(t,e={},a=!1){return BOXCoin.ajax(t,e,a)}function a(t,e=!0){return BOXCoin.activate(t,e)}function n(t,e=!1){M.card(t,e)}function i(t){return BXC_TRANSLATIONS&&t in BXC_TRANSLATIONS?BXC_TRANSLATIONS[t]:t}function c(t,e=!1){M.error(t,e)}function s(t,e=-1){return t&&A(t).e.length?(t=A(t).e[0],-1===e?A(t).is("checkbox")?t.checked:t.value.trim():(A(t).is("checkbox")?t.checked=0!=e&&e:t.value=e,void(A(t).is("textarea")&&h(t)))):""}function o(t){return A(t).find("input, select, textarea")}function r(){let t=window.location.href;if(t.includes("#")){let e=t.substr(t.indexOf("#"));if(e.includes("?")&&(e=e.substr(0,e.indexOf("?"))),e.length>1){let t=f.find(".bxc-nav "+e);if(t.e.length)return d(t),!0}}return!1}function d(n){if(!A(n).e.length)return;let i=f.find("main > div"),c=n.index();switch(v=A(i.e[c]),k=n.attr("id"),f.removeClass("bxc-area-transactions bxc-area-checkouts bxc-area-balances bxc-area-settings").addClass("bxc-area-"+k),a(i,!1),a(n.siblings(),!1),a(n),a(v),window.location.href.includes(k)||window.history.pushState("","","#"+k),k){case"transactions":t(v)||(D&&(D.destroy(),D=!1),t(v),R=0,y.find("tbody").html(""),U.print(()=>{t(i.e[c],!1)}));break;case"checkouts":t(v,"check")&&e("get-checkouts",{},e=>{let a="";S=e;for(var n=0;n<e.length;n++)a+=E.row(e[n]);u(f.find("#bxc-table-checkouts tbody"),a),t(i.e[c],!1)});break;case"balances":M.balance(v);break;case"settings":t(v,"check")&&e("get-settings",{},e=>{if(e){if(BXC_ADMIN_SETTINGS.apps.includes("exchange")){let t="custom-token-code",a="",n=0;for(;e[t+(n?"-"+(n+1):"")];)a+=`<option value="${e[t+(n?"-"+(n+1):"")]}">${e["custom-token-name"+(n?"-"+(n+1):"")]}</option>`,n++;a&&v.find("#exchange-default-get select").append(a)}M.repeater.open(e,v);for(var a in e){let t=f.find("#"+a);t&&s(o(t),e[a])}v.find("#btc-wallet-key input, #eth-wallet-key input, #ln-macaroon input").e.forEach(t=>{t.value&&(t.value="********")}),BOXCoin.event("SettingsLoaded",e)}t(i.e[c],!1)});break;case"analytics":D&&(D.destroy(),D=!1),BXCAdminShop.analytics(D)}}function l(t){return(t=t.replace(/_/g," ").replace(/-/g," ")).charAt(0).toUpperCase()+t.slice(1)}function u(t,e,a=!1){if(!e)return!t.html()&&t.html(`<p class="bxc-not-found">${i("There's nothing here yet.")}</p>`);t.find(".bxc-not-found").remove(),t.html((a?t.html():"")+e)}function b(){h(this)}function h(t){t.style.height="auto",t.style.height=t.scrollHeight+"px"}var p,f,m,x,v,k,y,g,C,_,$,w,B=[!1,!1,!1,!1,!1],X={P:"Pending",C:"Completed",R:"Refunded",X:"Underpayment"},R=0,O=!0,N=new Date,S=!1,T=window.innerWidth<769,D=!1,L=!1,I={format:"dd/mm/yyyy",maxDate:new Date,dateDelimiter:" - ",separator:" - ",clearBtn:!0},A=window._query,U={get:function(t,a=!1,n=!1,i=!1,c=!1,s=!1){e("get-transactions",{pagination:R,search:a,status:n,cryptocurrency:i,date_range:c,checkout_id:s},e=>{R++,t(e)})},print:function(t,e=B[0],a=B[1],n=B[2],c=B[3],s=B[4]){this.get(e=>{let a="";O=e.length;for(var n=0;n<O;n++){let t=e[n],s=t.from?`<a href="${M.explorer(t.cryptocurrency,t.from)}" target="_blank" class="bxc-link">${t.from}</a>`:"",o=t.currency.toUpperCase()+" "+t.amount_fiat,r="",d=t.description.replace(/\[|\]|"/g,""),u=["","","","","",""],b="",h=[t.amount?t.amount+" "+BOXCoin.baseCode(t.cryptocurrency.toUpperCase()):t.amount_fiat?o:i("Free"),t.amount?o:t.amount_fiat?l(BOXCoin.baseCode(t.cryptocurrency)):""];if(T){u=["ID","Date","From","To","Status","Amount"];for(var c=0;c<u.length;c++)u[c]='<div class="bxc-label">'+i(u[c])+"</div>"}t.vat_details&&(r=JSON.parse(t.vat_details),r=` data-vat="${t.currency} ${r.amount} (${r.percentage}%, ${r.country})"`),BXC_ADMIN_SETTINGS.apps.includes("shop")&&(b=` data-license-key="${t.license_key?t.license_key:""}" data-license-key-status="${t.license_key_status?t.license_key_status:""}" data-customer-id="${t.customer_id?t.customer_id:""}"`),a+=`<tr data-id="${t.id}"${b} data-checkout-id="${t.checkout_id}" data-title="${t.title}" data-currency="${t.currency}" data-cryptocurrency="${t.cryptocurrency}" data-hash="${t.hash}" data-notes="${d.replace(/,/g,"<br>")}" data-status="${t.status}"${t.billing?' data-invoice="true"':""}${r} data-discount-code="${t.discount_code?t.discount_code:""}" data-amount="${t.amount_fiat?t.amount_fiat:t.amount}" data-type="${t.type?t.type:1}"><td class="bxc-td-id">${u[0]}${t.id}</td><td class="bxc-td-time">${u[1]}<div class="bxc-title">${BOXCoin.beautifyTime(t.creation_time,!0)}</div></td><td class="bxc-td-from">${s?u[2]:""}${s}</td><td class="bxc-td-to">${t.to?u[3]:""}${t.to?`<a href="${M.explorer(t.cryptocurrency,t.to)}" target="_blank" class="bxc-link">${t.to}</a>`:""}</td><td class="bxc-td-status">${u[4]}<span class="bxc-status-${t.status}">${i(X[t.status])}</span></td><td class="bxc-td-amount">${u[5]}<div class="bxc-title"><div>${h[0]}</div><div>${t.cryptocurrency&&h[1].includes(t.cryptocurrency.toUpperCase())?"":h[1]}</div></div></td><td><i class="bxc-transaction-menu-btn bxc-icon-menu"></i></td></tr>`}u(y.find("tbody"),a,!0),t&&t(e)},e,a,n,c,s)},query:function(e=!1){t(y)||(y.find("tbody").html(""),R=0,B[0]=A(f).find("#bxc-search-transactions").val().toLowerCase().trim(),B[1]=A(f).find(".bxc-filter-status li.bxc-active").data("value"),B[2]=A(f).find(".bxc-filter-cryptocurrency li.bxc-active").data("value"),B[3]=!!D&&D.getDates("yyyy-mm-dd"),B[4]=A(f).find(".bxc-filter-checkout li.bxc-active").data("value"),this.print(()=>{e&&t(e,!1),t(y,!1)}))},download:function(t){e("download-transactions",{search:B[0],status:B[1],cryptocurrency:B[2],date_range:B[3],checkout_id:B[4]},e=>{t(e)})}},E={row:function(t){return`<tr data-checkout-id="${t.id}"><td><div class="bxc-title"><span>${t.id}</span><span>${t.title}</span></div></td><td><div class="bxc-text">${t.currency?t.currency:BXC_CURRENCY} ${t.price}</div></td></tr>`},embed:function(t=!1){let e=g?3:2;for(var a=0;a<e;a++){let e=v.find("#bxc-checkout-"+(0==a?"payment-link":1==a?"embed-code":"shortcode")).find("div, i");if(t){let n=0==a?`${BXC_URL}pay.php?checkout_id=${t}${BXC_CLOUD.cloud?"&cloud="+BXC_CLOUD.cloud:""}`:1==a?`<div data-boxcoin="${t}"></div>${BXC_CLOUD.cloud?' <script id="boxcoin" src="'+BXC_URL+"js/client.js?cloud="+BXC_CLOUD.cloud+'"><\/script>':""}`:`[boxcoin id="${t}"]`;A(e.e[0]).html(0==a?`<a href="${n}" target="_blank">${n}</a>`:n.replace(/</g,"&lt;")),A(e.e[1]).data("text",window.btoa(n))}else A(e.e[0]).html(""),A(e.e[1]).data("text","")}},get:function(t,e=!1){for(var a=0;a<S.length;a++)if(t==S[a].id)return e?(S.splice(a,1),!0):S[a];return!1}},M={active_element:!1,card:function(t,e=!1){var a=f.find(".bxc-info-card");a.removeClass("bxc-info-card-error bxc-info-card-warning bxc-info-card-info"),e?"error"==e?a.addClass("bxc-info-card-error"):a.addClass("bxc-info-card-info"):clearTimeout(m),a.html(i(t)),m=setTimeout(()=>{a.html("")},5e3)},error:function(e,a=!1){window.scrollTo({top:0,behavior:"smooth"}),f.find(".bxc-info").html(e),a&&t(a,!1)},confirm:function(t,e,a,n=!1){if(n)return e();BOXCoin.lightbox(i("Are you sure?"),'<div class="bxc-text">'+i(t)+"</div>",[["bxc-confirm-btn","Confirm"],["bxc-cancel-btn","Cancel"]],"confirm"),w=[e,a]},balance:function(a){if(!t(a)){let n=f.find("#bxc-table-balances tbody");if(!n.e.length)return;n.html()||a.addClass("bxc-loading-first"),e("get-balances",{},e=>{let i="",c=e.balances;f.find("#bxc-balance-total").html(`${BXC_CURRENCY} ${e.total}`);for(var s in c){i+=`<tr data-cryptocurrency="${s}"><td><div class="bxc-flex"><img src="${s in e.token_images?e.token_images[s]:`${BXC_URL}media/icon-${s}.svg`}" /> ${c[s].name}${BOXCoin.network(s,!0,!0)}</div></td><td><div class="bxc-balance bxc-title">${c[s].amount} ${BOXCoin.baseCode(s).toUpperCase()}</div><div class="bxc-text">${BXC_CURRENCY} ${c[s].fiat}</div></td></tr>`}i?n.html(i):n.parent().html('<p class="bxc-text">Add your addresses from the Settings area.</p>'),a.removeClass("bxc-loading-first"),t(a,!1)})}},explorer:function(t,e,a="address"){let n="",i="address"==a?"address":["ltc","usdt_tron"].includes(t)?"transaction":"tx";switch(t){case"btc":n="https://www.blockchain.com/btc/{R}/{V}";break;case"eth":n="https://www.blockchain.com/eth/{R}/{V}";break;case"doge":n="https://dogechain.info/{R}/{V}";break;case"link":case"bat":case"shib":case"usdc":case"usdt":n="https://etherscan.io/{R}/{V}"+("address"==a?"":"#tokentxns");break;case"usdt_tron":n="https://tronscan.org/#/{R}/{V}";break;case"algo":n="https://algoexplorer.io/{R}/{V}";break;case"stripe":n="https://dashboard.stripe.com/customers/{V}";break;case"verifone":n="https://secure.2checkout.com/cpanel/order_info.php?refno={V}";break;case"usdt_bsc":case"busd":case"bnb":n="https://bscscan.com/{R}/{V}";break;case"ltc":n="https://blockchair.com/litecoin/{R}/{V}";break;case"bch":n="https://www.blockchain.com/bch/{R}/{V}";break;case"xrp":i="address"==a?"accounts":"transactions",n="https://livenet.xrpl.org/{R}/{V}";break;default:let e=BOXCoin.network(t,"code");"eth"==e&&(n="https://etherscan.io/{R}/{V}"+("address"==a?"":"#tokentxns")),"bsc"==e&&(n="https://bscscan.com/{R}/{V}")}return n.replace("{R}",i).replace("{V}",e)},datepicker:function(t){D&&D.destroy(),(D=new DateRangePicker(A(t).parent().e[0],I)).datepickers[0].show()},repeater:{add:function(t,e=!0,a=!1){let n=A(t).parent(),i=n.find("[data-type], hr"),c='<div class="bxc-repater-line"><hr /><i class="bxc-icon-close"></i></div>';a=a||parseInt(A(t).data("index"));for(var s=0;s<i.e.length&&"HR"!=i.e[s].nodeName;s++){let t=A(i.e[s]).attr("id");c+=i.e[s].outerHTML.replace(t,t+"-"+a)}if(!e)return c;c+=t.outerHTML.replace('"'+a+'"','"'+(a+1)+'"'),t.remove(),n.append(c)},open:function(t,e){e.find(".bxc-btn-repater").e.forEach(e=>{let a=2,n="",i=A(e.parentElement).find("[id]").attr("id");for(;i+"-"+a in t;)n+=this.add(e,!1,a),a++;n&&(n+=e.outerHTML.replace('"2"','"'+a+'"'),A(e).parent().append(n),e.remove())})},delete:function(t){let e=A(t).hasClass("bxc-first-repeater-item"),a=A(t).parent(),n=Array.from(a.parent().e[0].childNodes),i=n.indexOf(a.e[0])+1,c=a.parent().find(".bxc-btn-repater"),r=parseInt(c.data("index"))-1,d=!1;for(t=i;t<n.length;t++){let a=A(n[t]);if(d||a.hasClass("bxc-repater-line")||a.hasClass("bxc-btn-repater")){d=!0;let t=a.attr("id"),e=parseInt(!(!t||!t.includes("-"))&&t.substr(t.lastIndexOf("-")+1));e&&a.attr("id",t.replace("-"+e,"-"+(e-1)))}else e?s(o(a),""):a.remove()}c.data("index",r),e||a.remove()}}};window.BXCTransactions=U,window.BXCCheckout=E,window.BXCAdmin=M,document.addEventListener("DOMContentLoaded",()=>{if(p=A(document.body),(f=p.find(".bxc-main")).e.length){if(x=f.find("main > div"),v=x.e[0],y=f.find("#bxc-table-transactions"),_=p.find("#bxc-upload-form input"),g="undefined"!=typeof BXC_WP,BOXCoin.cookie("BXC_LOGIN")&&!f.hasClass("bxc-installation")){k="transactions",r()||U.print(()=>{t(v,!1)}),localStorage.getItem("bxc-cron")!=N.getDate()&&(e("cron",{domain:BXC_URL}),localStorage.setItem("bxc-cron",N.getDate()));let a=document.getElementsByTagName("textarea");for(let t=0;t<a.length;t++)a[t].setAttribute("style","height:"+a[t].scrollHeight+"px;overflow-y:hidden;"),a[t].addEventListener("input",b,!1);M.balance(f.find('main > [data-area="balance"]'))}y.on("click","tr",function(t){if(["A","I","LI"].includes(t.target.nodeName))return;let e=A(this).data("hash");if(e){let t=A(this).data("cryptocurrency"),a=M.explorer(t,e,"tx");a&&window.open(a)}}),f.on("click","#bxc-filters",function(){f.find(".bxc-nav-filters").toggleClass("bxc-active")}),f.on("click",".bxc-filter-date",function(){L?D||M.datepicker(this):(A.load(BXC_URL+"vendor/datepicker/datepicker.min.css",!1),A.load(BXC_URL+"vendor/datepicker/datepicker.min.js",!0,()=>{BXC_LANG?(I.language=BXC_LANG,A.load(`${BXC_URL}vendor/datepicker/locales/${BXC_LANG}.js`,!0,()=>{L=!0,M.datepicker(this)})):(L=!0,M.datepicker(this))}))}),f.on("click",".bxc-filter-status li, .bxc-filter-cryptocurrency li, .bxc-filter-checkout li, .datepicker-cell, .datepicker .clear-btn",function(){setTimeout(()=>{"transactions"==k?U.query():BXCAdminShop.analytics(D)},100)}),f.on("click","#bxc-download-transitions",function(){t(this)||U.download(e=>{window.open(e),t(this,!1)})}),y.on("click",".bxc-transaction-menu-btn:not(.bxc-loading)",function(){let t=A(this).hasClass("bxc-active"),e=A(this.closest("tr")),n=`<ul class="bxc-transaction-menu bxc-ul"><li data-value="details">${i("Details")}</li>`,c=e.data("status"),s=e.data("cryptocurrency");if(a(y.find(".bxc-transaction-menu-btn"),!1),y.find(".bxc-transaction-menu").remove(),!t){a(this),"P"==c&&e.data("amount")?n+=`<li data-value="payment-link">${i("Payment link")}</li>`:BXC_ADMIN_SETTINGS.invoice&&(n+=`<li data-value="invoice">${i("Invoice")}</li>`),["C","X"].includes(c)&&(BXC_REFUNDS.includes("coinbase")&&["btc","eth","xrp","usdt","usdc","busd","bnb","link","doge","shib","ltc","algo","bat","bch"].includes(s)||BXC_REFUNDS.includes("btc")&&"btc"==s||BXC_REFUNDS.includes("eth")&&["eth","usdt","usdc","link","shib","bat"].includes(s))&&(n+=`<li data-value="refund">${i("Issue a refund")}</li>`);for(var o in X)o!=c&&(n+=`<li data-value="${o}">${i("Mark as "+X[o].toLowerCase())}</li>`);A(this).parent().append(n+"</ul>")}}),y.on("click",".bxc-transaction-menu li",function(){let c=A(this.closest("tr")),s=c.find(".bxc-transaction-menu-btn");if(t(s))return;let o=A(this).data("value"),r=c.data("id");if(["C","P","R"].includes(o)){let a;if("C"==o)switch(c.data("type")){case"2":case"1":a="The transaction will be processed, and any user purchase associated with it will be processed and finalized.";break;case"3":a="The exchange will be processed and the amount to be exchanged will be automatically sent to the user."}M.confirm(a,()=>{e("update-transaction",{transaction_id:r,values:{status:o}},e=>{!0===e?c.data("status",o).find(".bxc-td-status span").attr("class","bxc-status-"+o).html(i(X[o])):n(e,"error"),t(s,!1)})},s,!a)}if("invoice"==o&&e("encryption",{string:r},e=>{window.open(BXC_URL+"pay.php?invoice="+e),t(s,!1)}),"payment-link"==o&&e(o,{transaction_id:r},e=>{window.open(e),t(s,!1)}),"details"==o){let a='<div class="bxc-text-list bxc-transaction-details-list">',n=[["ID","id"],["Checkout","data-title"],["Hash","data-hash"],["Time","time"],["Notes","data-notes"],["Status","status"],["From","from"],["To","to"],["Amount","amount"],["VAT","data-vat"],["License key","data-license-key"]];for(var d=0;d<n.length;d++){let t=n[d][1],e=t.includes("data")?c.attr(t):c.find(".bxc-td-"+t).html();if(e){if(e=e.trim(),"data-hash"==t)e=`<a href="${M.explorer(c.data("cryptocurrency"),e,"tx")}" target="_blank">${e}</a>`;else if("data-title"==t)e=e+" - ID "+c.data("checkout-id");else if("data-notes"==t)e=e.replaceAll("\\r\\n","\n").replaceAll("\\r","\n").replaceAll("\\n","<br>").replaceAll("\n","<br>");else if("data-license-key"==t){let t=c.attr("data-license-key-status").trim();1!=t&&(e='<div class="bxc-label-code">'+e+'</div><div class="bxc-label">'+i("Disabled")+"</div>"),e+=`<div id="bxc-btn-license-key-status" class="bxc-btn-text bxc-underline" data-status="${t}" data-id="${c.find(".bxc-td-id").html()}">${i(1==t?"Disable":"Enable")}</div>`}a+=`<div data-name="${t}"><div>${i(n[d][0])}</div><div>${e}</div></div>`}}BXC_ADMIN_SETTINGS.apps.includes("shop")&&(c.data("discount-code")&&(a+=`<div><div>${i("Discount code")}</div><div>${c.data("discount-code")}</div></div>`),c.data("customer-id")&&(a+=`<div data-name="customer"><div>${i("Customer details")}</div><div class="bxc-loading"></div></div>`,e("get-customer",{customer_id:c.data("customer-id")},t=>{let e=t.first_name+(t.last_name?" "+t.last_name:"");p.find('#bxc-lightbox [data-name="customer"] .bxc-loading').html((e?e+" - ":"")+"ID "+t.id+(t.email?"<br>"+t.email:"")+(t.phone?"<br>"+t.phone:"")+(t.country?"<br>"+t.country+" "+t.country_code:"")).removeClass("bxc-loading")}))),BOXCoin.lightbox("Transaction details",a),t(s,!1)}"refund"==o&&(n(i("Sending refund in 5 seconds.")+' <span id="cancel-refund">'+i("Cancel")+"</span>","info"),C=setTimeout(()=>{e(o,{transaction_id:r},e=>{if(!0===e.status){c.data("status",o).find(".bxc-td-status span").attr("class","bxc-status-R").html(i(X.R)),n(e.message);let t=f.find(".bxc-info-card a");t.attr("href",M.explorer(c.data("cryptocurrency"),t.data("hash"),"tx"))}else n(e.message,"error");t(s,!1)})},5e3)),c.find(".bxc-ul").remove(),a(s,!1)}),f.on("click","#cancel-refund",function(){clearTimeout(C),t(y.find(".bxc-loading"),!1)}),f.on("click","#bxc-request-payment",function(){let t="",e=[["price","Price","number"],["currency","Currency code","text"],["pay","Cryptocurrency code","text"],["redirect","Redirect URL","url"],["note","Notes","text"]];for(var a=0;a<e.length;a++)t+=`<div class="bxc-input"><span>${i(e[a][1])}</span><input data-url-attribute="${i(e[a][0])}" type="${i(e[a][2])}"></div>`;BOXCoin.lightbox("Create a payment request",t+`<div id="bxc-create-payment-link" class="bxc-btn">${i("Create payment link")}</div>`)}),p.on("click","#bxc-create-payment-link",function(){let t=A(this).parent().find("input").e,e="";for(var a=0;a<t.length;a++){let n=A(t[a]).data("url-attribute"),i=A(t[a]).val();i&&("redirect"!=n&&"note"!=n||(i=encodeURIComponent(i)),e+="&"+n+"="+i)}e&&(e=`${BXC_URL}pay.php?checkout_id=custom-${Math.floor(Date.now()/1e3)}${BXC_CLOUD.cloud?"&cloud="+BXC_CLOUD.cloud:""}${e}`,A(this).parent().find("#bxc-payment-request-url-box").remove(),A(this).insert(`<div id="bxc-payment-request-url-box" class="bxc-input"><a href="${e}" target="_blank">${e.replace(/&/g,"&amp")}</a><i class="bxc-icon-copy bxc-clipboard" data-text="${window.btoa(e)}"></i></div>`))}),p.on("click","#bxc-btn-license-key-status",function(){let t=1==A(this).data("status")?2:1,a=A(this).data("id");e("update-license-key-status",{transaction_id:a,status:t},()=>{A(this).html(i(1==t?"Disable":"Enable")).data("status",t),y.find(`[data-id="${a}"]`).data("data-license-key-status",t),A(this).parent().find(".bxc-label").remove(),1!=t&&A(this).insert('<div class="bxc-label">'+i("Disabled")+"</div>")})}),f.on("click","#bxc-create-checkout, #bxc-table-checkouts td",function(){let t=!1;if(f.addClass("bxc-area-create-checkout"),A(this).is("td")){let a=A(this).parent().data("checkout-id");t=E.get(a),v.data("checkout-id",a);for(var e in t){s(o(v.find(`#bxc-checkout-${e}`)),t[e])}E.embed(a)}else o(v).e.forEach(t=>{s(t,"")}),v.find("#bxc-checkout-type select").val("I"),v.data("checkout-id",""),E.embed();BXC_ADMIN_SETTINGS.apps.includes("shop")&&BXCAdminShop.checkoutOpen(t,v)}),f.on("click","#bxc-checkouts-list",function(){f.removeClass("bxc-area-create-checkout"),v.data("checkout-id","")}),f.on("click","#bxc-save-checkout",function(){if(t(this))return;let a=!1,i={},o=v.find(".bxc-input"),r=v.data("checkout-id");f.find(".bxc-info").html(""),o.removeClass("bxc-error"),o.e.forEach(t=>{let e=A(t).attr("id"),n=A(t).find("input, select"),c=s(n);!c&&n.e.length&&n.e[0].hasAttribute("required")&&(a=!0,A(t).addClass("bxc-error")),i[e.replace("bxc-checkout-","")]=c}),a?c("Fields in red are required.",this):(r&&(i.id=r),BXC_ADMIN_SETTINGS.apps.includes("shop")&&(i=BXCAdminShop.checkoutSave(i,v)),e("save-checkout",{checkout:JSON.stringify(i)},e=>{t(this,!1),Number.isInteger(e)?(i.id=e,v.data("checkout-id",e),v.find("#bxc-table-checkouts tbody").append(E.row(i)),E.embed(e),S.push(i),n("Checkout saved successfully")):!0===e?(E.get(r,!0),S.push(i),v.find(`tr[data-checkout-id="${r}"]`).replace(E.row(i)),n("Checkout saved successfully")):c(e,this.closest("form"))}))}),f.on("click","#bxc-delete-checkout",function(){if(t(this))return;let a=v.data("checkout-id");e("delete-checkout",{checkout_id:a},()=>{t(this,!1),v.data("checkout-id",""),v.find(`tr[data-checkout-id="${a}"]`).remove(),v.find("#bxc-checkouts-list").e[0].click(),n("Checkout deleted","error")})}),f.on("click","#checkout-downloads .bxc-repater-line i",function(){let t=A(this).parent().next().find("input").val();t&&e("delete-file",{file_name:t})}),f.on("click","#checkout-downloads input",function(){A(this).val()&&window.open(BXC_URL+"uploads/checkout/"+A(this).val())}),f.on("click","#bxc-save-settings",function(){if(t(this))return;let a={};f.find('[data-area="settings"]').find('.bxc-input[id]:not([data-type="multi-input"]),[data-type="multi-input"] [id]').e.forEach(t=>{a[A(t).attr("id")]=s(o(t))}),e("save-settings",{settings:JSON.stringify(a)},e=>{n(!0===e?"Settings saved":e,!0!==e&&"error"),t(this,!1)})}),f.on("click","#update-btn a",function(a){if(!t(this))return e("update",{domain:BXC_URL},e=>{t(this,!1);let a=!1,i=!0;if("string"==typeof e)n(l(e),"error");else{for(var c in e)!0!==e[c]&&"latest-version-installed"!==e[c]?a=!0:!0===e[c]&&(i=!1);i?n("You have the latest version!"):a?n(l(JSON.stringify(e)),"error"):(n("Update completed. Reload in progress..."),setTimeout(()=>{location.reload()},500))}}),a.preventDefault(),!1}),f.on("click","#email-test-btn a",function(a){if(!t(this))return e("email-test",{},e=>{n(!0===e?"Email successfully sent.":e),t(this,!1)}),a.preventDefault(),!1}),f.on("click",".bxc-btn-repater",function(){M.repeater.add(this)}),f.on("click",".bxc-repater-line i",function(){M.repeater.delete(this)}),T&&f.on("click",".bxc-icon-menu",function(){let t=A(this).parent();a(t,!t.hasClass("bxc-active"))}),f.on("click","#bxc-submit-installation",function(){if(t(this))return;let a=!1,n={},i=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,""),s=f.find(".bxc-input");if(s.removeClass("bxc-error"),f.find(".bxc-info").html(""),s.e.forEach(t=>{let e=A(t).attr("id"),i=A(t).find("input"),c=i.val().trim();!c&&i.e[0].hasAttribute("required")&&(a=!0,A(t).addClass("bxc-error")),n[e]=c}),a){a="Username, password and the database details are required.";let t=n.password;return t&&(t.length<8?a="Minimum password length is 8 characters.":t!=n["password-check"]&&(a="The passwords do not match.")),void c(a,this)}i.includes("?")&&(i=i.substr(0,i.indexOf("?"))),n.url=i+"/",e("installation",{installation_data:JSON.stringify(n)},t=>{!0===t?location.reload():c(t,this)})}),f.on("click",".bxc-nav > div",function(){d(A(this))}),f.on("click","#bxc-submit-login",function(){t(this)||e("login",{username:f.find("#username input").val().trim(),password:f.find("#password input").val().trim()},e=>{e?(BOXCoin.cookie("BXC_LOGIN",e,365,"set"),location.reload()):(f.find(".bxc-info").html("Invalid username or password."),t(this,!1))})}),f.on("click","#bxc-logout",function(){BOXCoin.cookie("BXC_LOGIN",!1,!1,"delete"),BOXCoin.cookie("BXC_CLOUD",!1,!1,"delete"),location.reload()}),f.on("click","#bxc-card",function(){A(this).html("")}),f.on("input",".bxc-search-input",function(){BOXCoin.search(this,(t,e)=>{"transactions"==k&&U.query(e,t)})}),f.on("click","#bxc-table-balances tr",function(){let t=A(this).data("cryptocurrency"),e=M.explorer(t,BXC_ADDRESS[t]);e&&window.open(e)}),window.onscroll=function(){v&&(document.documentElement||document.body.parentNode||document.body).scrollTop+window.innerHeight==A.documentHeight()&&O&&"transactions"==k&&(A(v).find("> .bxc-loading-global").e.length||(U.print(()=>{window.scrollTo(0,document.body.scrollHeight-800),A(v).find("> .bxc-loading-global").remove()}),A(v).append('<div class="bxc-loading-global bxc-loading"></div>')))},window.onpopstate=function(){r()},document.addEventListener("click",function(t){M.active_element&&!M.active_element.contains(t.target)&&(a(M.active_element,!1),M.active_element=!1)}),f.on("click",'[data-type="upload-file"] > div',function(){t(this,"check")||(_.val(""),_.e[0].click(),$=this)}),_&&_.e.length&&_.e[0].addEventListener("change",function(e){let a=this.files;t($);for(var n=0;n<a.length;n++){let e=a[n],s=e.size/1048576,o=BXC_ADMIN_SETTINGS.max_file_size,r=new FormData;if(s>o)return c(i("Maximum upload size is {R}MB. File size: {R2}MB.").replace("{R}",o).replace("{R2}",s.toFixed(2)),this);r.append("file",e),fetch(BXC_URL+"upload.php?target="+A($).parent().data("upload-target"),{method:"POST",body:r}).then(t=>t.json()).then(function(e){if(t($,!1),e[0]){let t=A($).parent();t.find("input").val(e[2]),t.hasClass("bxc-upload-image")&&(t.find(".bxc-btn-icon").e[0].style.backgroundImage='url("'+e[1]+'")')}else c(e[1]);BOXCoin.event("BXCUpload",e)})}this.value=""}),f.on("click",".bxc-upload-image > i",function(){A(this).prev().attr("style",""),A(this).prev().prev().val("")}),p.on("click","#bxc-confirm-btn, #bxc-cancel-btn",function(){"bxc-cancel-btn"==A(this).attr("id")?w[1]&&t(w[1],!1):w[0](),BOXCoin.lightboxClose()})}})}();